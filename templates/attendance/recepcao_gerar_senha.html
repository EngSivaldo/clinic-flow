{% extends "layouts/base.html" %}
{% block title %}Recepção • Gerar Senha{% endblock %}

{% block content %}
<div class="mb-6">
    <h2 class="text-2xl font-bold text-slate-800 tracking-tight">Atendimento de Recepção</h2>
    <p class="text-slate-500">Cadastre o paciente para iniciar o fluxo de triagem.</p>
</div>

<div class="grid md:grid-cols-3 gap-6">

    <div class="md:col-span-2 bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
        <div class="bg-slate-50 px-6 py-4 border-b border-slate-200">
            <h3 class="font-bold text-slate-700 uppercase text-xs tracking-wider">Dados do Paciente</h3>
        </div>
        
        <form method="post" action="{% url 'attendance:recepcao_gerar_senha' %}" class="p-6 space-y-5">
            {% csrf_token %}

            {% if form.non_field_errors %}
                <div class="p-3 bg-red-50 text-red-700 rounded-lg text-sm border border-red-200">
                    {{ form.non_field_errors }}
                </div>
            {% endif %}

            <div>
                <label class="block text-sm font-bold text-slate-700 mb-1">Nome Completo</label>
                <input type="text" name="nome" value="{{ form.nome.value|default_if_none:'' }}" required 
                    class="w-full px-4 py-2 rounded-lg border {% if form.nome.errors %}border-red-500{% else %}border-slate-300{% endif %} focus:ring-2 focus:ring-blue-500 outline-none transition-all">
                {% if form.nome.errors %}
                    <span class="text-red-500 text-xs font-bold">{{ form.nome.errors.0 }}</span>
                {% endif %}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">CPF</label>
                    <input type="text" name="cpf" value="{{ form.cpf.value|default_if_none:'' }}" required
                        placeholder="000.000.000-00"
                        class="w-full px-4 py-2 rounded-lg border {% if form.cpf.errors %}border-red-500{% else %}border-slate-300{% endif %} focus:ring-2 focus:ring-blue-500 outline-none">
                    {% if form.cpf.errors %}
                        <span class="text-red-500 text-xs font-bold">{{ form.cpf.errors.0 }}</span>
                    {% endif %}
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">Telefone</label>
                    <input type="text" name="telefone" value="{{ form.telefone.value|default_if_none:'' }}"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">Data de Nascimento</label>
                    <input type="date" name="data_nascimento" value="{{ form.data_nascimento.value|default_if_none:'' }}"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <div>
                    <label class="block text-sm font-bold text-slate-700 mb-1">Nome da Mãe</label>
                    <input type="text" name="nome_mae" value="{{ form.nome_mae.value|default_if_none:'' }}"
                        class="w-full px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
            </div>

            <div class="pt-4 border-t border-slate-100">
                <button type="submit"
                    class="w-full md:w-auto bg-[#004a99] hover:bg-blue-800 text-white px-10 py-4 rounded-xl font-bold shadow-lg transition-all transform active:scale-95">
                    GERAR SENHA DE ATENDIMENTO
                </button>
            </div>
        </form>
    </div>

    <div class="flex flex-col gap-6">
        <div class="bg-[#004a99] text-white rounded-3xl shadow-xl p-8 flex flex-col justify-center items-center text-center border-b-8 border-blue-900 relative overflow-hidden">
            <div class="absolute -right-10 -top-10 w-32 h-32 bg-white/10 rounded-full"></div>
            
            <h2 class="text-blue-200 font-bold uppercase tracking-widest text-xs relative z-10">Última Senha Gerada</h2>

            {% if senha_gerada %}
                <div class="text-8xl font-black my-8 tabular-nums tracking-tighter relative z-10 animate-in fade-in zoom-in duration-500">
                    {{ senha_gerada }}
                </div>
                
                <a href="{% url 'attendance:recepcao_gerar_senha' %}" 
                   class="bg-emerald-500 hover:bg-emerald-600 text-white px-6 py-3 rounded-xl text-sm font-black uppercase mb-4 shadow-lg transition-all transform hover:scale-105 active:scale-95 relative z-20">
                    ✓ PRÓXIMO PACIENTE
                </a>

                <p class="text-blue-100 text-sm leading-relaxed relative z-10">
                    Oriente o paciente a aguardar a chamada na <strong>TV DA RECEPÇÃO</strong>.
                </p>
            {% else %}
                <div class="py-16 flex flex-col items-center opacity-30">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" />
                    </svg>
                    <p class="font-medium italic">Aguardando registro...</p>
                </div>
            {% endif %}
        </div>

        <div class="bg-amber-50 border border-amber-200 p-6 rounded-2xl">
            <h4 class="text-amber-800 font-bold text-sm mb-2">Dica de Fluxo:</h4>
            <p class="text-amber-700 text-xs leading-relaxed">
                Após gerar a senha, o sistema enviará automaticamente o paciente para a <strong>Fila de Triagem</strong>. Verifique se a TV 01 está ligada.
            </p>
        </div>
    </div>

</div>
{% endblock %}